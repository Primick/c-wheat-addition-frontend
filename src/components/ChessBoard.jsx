
import React,{useEffect,useState} from 'react';import { Chess } from 'chess.js'; const PIE={ wp:'♙', wn:'♘', wb:'♗', wr:'♖', wq:'♕', wk:'♔', bp:'♟', bn:'♞', bb:'♝', br:'♜', bq:'♛', bk:'♚' }; function sc(r,c){return (r+c)%2===0?'light':'dark'}
export default function ChessBoard({startingFen,onMove,theme}){const [game,setGame]=useState(new Chess(startingFen||undefined));const [board,setBoard]=useState(game.board());const [sel,setSel]=useState(null);useEffect(()=>{const g=new Chess(startingFen||undefined);setGame(g);setBoard(g.board());setSel(null)},[startingFen]); function click(r,c){const file='abcdefgh'[c];const rank=8-r;const sq=file+rank; if(sel===null){const piece=board[r][c]; if(!piece) return; setSel(sq)} else {const from=sel; const to=sq; const g=new Chess(game.fen()); const m=g.move({from,to,promotion:'q'}); setSel(null); if(m){ setGame(new Chess(g.fen())); setBoard(g.board()); if(onMove) onMove(m) } } }
const rows=[]; for(let r=0;r<8;r++){const cols=[]; for(let c=0;c<8;c++){const col=sc(r,c); const piece=board[r][c]; let key=''; if(piece) key=(piece.color==='w'?'w':'b')+piece.type; cols.push(<td key={c} className={'square '+col} onClick={()=>click(r,c)} style={{background: col==='light' ? (theme?.light||'#f0d9b5') : (theme?.dark||'#b58863')}}><div className='cell'>{ piece? <span className={'piece '+(piece.color==='w'?'white':'black')}>{PIE[key]}</span> : null }</div></td>) } rows.push(<tr key={r}>{cols}</tr>) } return <div className='boardwrap'><table className='board'><tbody>{rows}</tbody></table></div> }
