
import React,{useEffect,useState} from 'react';import ChessBoard from '../components/ChessBoard.jsx';import RequestPanel from '../components/RequestPanel.jsx';import { Chess } from 'chess.js'; const THEMES={default:{light:'#f0d9b5',dark:'#b58863',boardBg:'#6b4b2f'},tournament:{light:'#efe6d6',dark:'#c7b89a',boardBg:'#3a3a3a'},neon:{light:'#111827',dark:'#0b1320',boardBg:'#071633'}};
export default function Play({account}){const [currentMatch,setCurrentMatch]=useState(null);const [fen,setFen]=useState(new Chess().fen());const [status,setStatus]=useState('Idle'); useEffect(()=>{window.addEventListener('cw_match_start',(e)=>{const data=e.detail; setCurrentMatch(data); setFen(new Chess().fen()); setStatus('Match started')})},[])
function startDemoMatchWith(opponentName){const match={id:'m_'+Math.random().toString(36).slice(2,9), players:[{name:opponentName},{name:'Streamer'}], startedAt:Date.now()}; localStorage.setItem('cw_current_match', JSON.stringify(match)); const ev=new CustomEvent('cw_match_start',{detail:match}); window.dispatchEvent(ev)}
function onMove(m){ setFen(new Chess().fen()); try{ const ctx=new (window.AudioContext||window.webkitAudioContext)(); const o=ctx.createOscillator(); const g=ctx.createGain(); o.type='sine'; o.frequency.value=880; g.gain.value=0.01; o.connect(g); g.connect(ctx.destination); o.start(); o.stop(ctx.currentTime+0.06) }catch(e){} }
return (<div className='play-page'><div className='board-column'><div className='board-controls'><button className='btn' onClick={()=>{ setFen(new Chess().fen()); setCurrentMatch(null); setStatus('New game') }}>New</button><button className='btn danger' onClick={()=>{ setFen(new Chess().fen()); setStatus('Aborted') }}>Abort</button><button className='btn' onClick={()=>alert('Offer draw sent')}>Offer Draw</button><button className='btn' onClick={()=>setStatus('Resigned')}>Resign</button></div><ChessBoard startingFen={fen} onMove={onMove} theme={THEMES.default} /><div className='status'>{status}</div></div><aside className='right-column'><RequestPanel account={account} onAccept={(r)=> startDemoMatchWith(r.name)} /><div className='panel'>Quick Actions</div></aside></div>) }
